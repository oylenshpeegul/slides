<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Chapter 6</title>
<meta name="author" content="Tim Heaney"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="../dist/reveal.css"/>

<link rel="stylesheet" href="../dist/theme/night.css" id="theme"/>

<link rel="stylesheet" href="./style.css"/>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Chapter 6</h1><p class="subtitle"></p>
<h2 class="author">Tim Heaney</h2><h2 class="date">2024-05-15</h2>
</section>

<section>
<section id="slide-orgea19107">
<h2 id="orgea19107">Agenda</h2>
<div class="outline-text-2" id="text-orgea19107">
</div>
</section>
<section id="slide-org21408a4">
<h3 id="org21408a4">Testing</h3>
<ul>
<li>Review</li>
<li><a href="https://rust-for-rustaceans.com/">Rust for Rustaceans</a></li>

</ul>

</section>
</section>
<section>
<section id="slide-org179effb">
<h2 id="org179effb">Review</h2>
<div class="outline-text-2" id="text-org179effb">
</div>
</section>
<section id="slide-org18b5a36">
<h3 id="org18b5a36"><a href="https://doc.rust-lang.org/stable/book/">The Rust Programming Language</a></h3>
<ul>
<li>chapter 11: <a href="https://doc.rust-lang.org/stable/book/ch11-00-testing.html">Writing Automated Tests</a></li>
<li><a href="https://www.youtube.com/watch?v=8A3oCwtenuY&amp;list=PL8AZrEE2-qZkcOFmpC03TwnVHSr25luFp&amp;index=5">Rust Book Study Session</a> video
<ul>
<li>2021-12-15</li>
<li>lead by Krzysztof</li>

</ul></li>

</ul>

</section>
<section id="slide-orge602781">
<h3 id="orge602781">Rust testing</h3>
<ol>
<li>Unit testing</li>
<li>Doc testing</li>
<li>Integration testing</li>
<li>Benchmark testing</li>

</ol>

</section>
<section id="slide-orge1d2a80">
<h3 id="orge1d2a80">Cargo generates "hello world" for a binary</h3>
<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>&#10095; cargo new hello
     Creating binary <span style="color: #ffffff;">(</span>application<span style="color: #ffffff;">)</span> <span style="color: #f78fe7;">`hello`</span> package

</code></pre>
</div>

</section>
<section id="slide-org60d4340">
<h3 id="org60d4340"><code>hello/src/main.rs</code></h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">main</span><span style="color: #ffffff;">()</span> <span style="color: #ffffff;">{</span>
    <span style="color: #f78fe7;">println!</span><span style="color: #ff62d4;">(</span><span style="color: #79a8ff;">"Hello, world!"</span><span style="color: #ff62d4;">)</span>;
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-org4ff93e2">
<h3 id="org4ff93e2"><code>cargo run</code></h3>
<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>&#10095; cd hello
&#10095; cargo run
   Compiling hello v0.1.0 <span style="color: #ffffff;">(</span>/home/tim/tmp/hello<span style="color: #ffffff;">)</span>
    Finished <span style="color: #f78fe7;">`dev`</span> profile <span style="color: #ffffff;">[</span>unoptimized + debuginfo<span style="color: #ffffff;">]</span> target<span style="color: #ffffff;">(</span>s<span style="color: #ffffff;">)</span> <span style="color: #b6a0ff;">in</span> 0.18s
     Running <span style="color: #f78fe7;">`/home/tim/rust/target/debug/hello`</span>
Hello, world!

</code></pre>
</div>

</section>
<section id="slide-org80d7935">
<h3 id="org80d7935">Cargo generates a test for a library</h3>
<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>&#10095; cargo new adder --lib
     Creating library <span style="color: #f78fe7;">`adder`</span> package

</code></pre>
</div>

</section>
<section id="slide-orga82c858">
<h3 id="orga82c858"><code>adder/src/lib.rs</code></h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">add</span><span style="color: #ffffff;">(</span><span style="color: #00d3d0;">left</span>: <span style="color: #6ae4b9;">usize</span>, <span style="color: #00d3d0;">right</span>: <span style="color: #6ae4b9;">usize</span><span style="color: #ffffff;">)</span> -&gt; <span style="color: #6ae4b9;">usize</span> <span style="color: #ffffff;">{</span>
    left + right
<span style="color: #ffffff;">}</span>

<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">cfg</span><span style="color: #ff62d4;">(</span><span style="color: #ff9077;">test</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">mod</span> <span style="color: #00bcff;">tests</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">use</span> <span style="color: #b6a0ff;">super</span>::*;

    <span style="color: #ff9077;">#</span><span style="color: #ff62d4;">[</span><span style="color: #ff9077;">test</span><span style="color: #ff62d4;">]</span>
    <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">it_works</span><span style="color: #ff62d4;">()</span> <span style="color: #ff62d4;">{</span>
        <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">result</span> = add<span style="color: #3fdfd0;">(</span>2, 2<span style="color: #3fdfd0;">)</span>;
        <span style="color: #ff9077;">assert_eq!</span><span style="color: #3fdfd0;">(</span>result, 4<span style="color: #3fdfd0;">)</span>;
    <span style="color: #ff62d4;">}</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-org91bf5c3">
<h3 id="org91bf5c3"><code>cargo test</code></h3>
<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>&#10095; cd adder
&#10095; cargo test
    Finished <span style="color: #f78fe7;">`test`</span> profile <span style="color: #ffffff;">[</span>unoptimized + debuginfo<span style="color: #ffffff;">]</span> target<span style="color: #ffffff;">(</span>s<span style="color: #ffffff;">)</span> <span style="color: #b6a0ff;">in</span> 0.00s
     Running unittests src/lib.rs <span style="color: #ffffff;">(</span>/home/tim/rust/target/debug/deps/adder-8c81ce131dde6a16<span style="color: #ffffff;">)</span>

running 1 test
<span style="color: #f78fe7;">test</span> tests::it_works ... ok

<span style="color: #f78fe7;">test</span> result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished<span style="color: #b6a0ff;"> in</span> 0.00s

   Doc-tests adder

running 0 tests

<span style="color: #f78fe7;">test</span> result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished<span style="color: #b6a0ff;"> in</span> 0.00s

</code></pre>
</div>

</section>
<section id="slide-orgf735efc">
<h3 id="orgf735efc">Macros</h3>
<ul>
<li class="fragment appear"><code>#[test]</code>, <code>#[cfg(test)]</code></li>
<li class="fragment appear"><code>assert!</code>, <code>assert_eq!</code>, &amp;c.</li>
<li class="fragment appear"><code>#[ignore]</code>, <code>#[should_panic]</code>, &amp;c.</li>

</ul>

</section>
<section id="slide-org282df87">
<h3 id="org282df87">Rust 1.78 stabilized <a href="https://blog.rust-lang.org/2024/05/02/Rust-1.78.0.html#diagnostic-attributes">diagnostic attributes</a></h3>
<p>
<code>#[diagnostic]</code>
</p>

</section>
<section id="slide-org1c46c44">
<h3 id="org1c46c44">Unstable Rust has a <a href="https://doc.rust-lang.org/nightly/unstable-book/library-features/test.html">bench attribute</a></h3>
<p>
<code>#[bench]</code>
</p>

</section>
<section id="slide-org7ef7cc4">
<h3 id="org7ef7cc4"><a href="https://exercism.org/">exercism.org</a></h3>
<ul>
<li>Programming exercises</li>
<li>Test-based</li>
<li>Has <a href="https://exercism.org/tracks/rust">a Rust track</a></li>
<li><code>cargo test -- --include-ignored</code></li>

</ul>

</section>
</section>
<section>
<section id="slide-orgbee35f2">
<h2 id="orgbee35f2"><a href="https://rust-for-rustaceans.com/">Rust for Rustaceans</a></h2>

<div id="org58d92f6" class="figure">
<p><img src="./towards-impeccable-rust.png" alt="towards-impeccable-rust.png" />
</p>
</div>

</section>
<section id="slide-org6175ed5">
<h3 id="org6175ed5">6. Testing</h3>
<ul>
<li>Rust Testing Mechanisms</li>
<li>Additional Testing Tools</li>
<li>Summary</li>

</ul>

</section>
<section id="slide-orgda43b93">
<h3 id="orgda43b93">Rust Testing Mechanisms</h3>
<ul>
<li>The Test Harness</li>
<li><code>#[cfg(test)]</code></li>
<li>Test-Only APIs</li>
<li>Bookkeeping for Test Assertions</li>
<li>Doctests</li>

</ul>

</section>
<section id="slide-orgf8bb3a6">
<h3 id="orgf8bb3a6">Additional Testing Tools</h3>
<ul>
<li>Linting</li>
<li>Test Generation
<ul>
<li>Fuzzing</li>
<li>Property-based testing</li>

</ul></li>
<li>Test Augmentation</li>
<li>Performance Testing
<ul>
<li>Performance Variance</li>
<li>Compiler Optimizations</li>
<li>I/O Overhead Measurement</li>

</ul></li>

</ul>

</section>
<section id="slide-orgd3f0393">
<h3 id="orgd3f0393">Summary</h3>

</section>
</section>
<section>
<section id="slide-org97d9f48">
<h2 id="org97d9f48">Rust Testing Mechanisms</h2>
<div class="outline-text-2" id="text-org97d9f48">
</div>
</section>
<section id="slide-org699e524">
<h3 id="org699e524">The Test Harness</h3>

</section>
<section id="slide-org5f57167">
<h3 id="org5f57167">look at adder again</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">add</span><span style="color: #ffffff;">(</span><span style="color: #00d3d0;">left</span>: <span style="color: #6ae4b9;">usize</span>, <span style="color: #00d3d0;">right</span>: <span style="color: #6ae4b9;">usize</span><span style="color: #ffffff;">)</span> -&gt; <span style="color: #6ae4b9;">usize</span> <span style="color: #ffffff;">{</span>
    left + right
<span style="color: #ffffff;">}</span>

<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">cfg</span><span style="color: #ff62d4;">(</span><span style="color: #ff9077;">test</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">mod</span> <span style="color: #00bcff;">tests</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">use</span> <span style="color: #b6a0ff;">super</span>::*;

    <span style="color: #ff9077;">#</span><span style="color: #ff62d4;">[</span><span style="color: #ff9077;">test</span><span style="color: #ff62d4;">]</span>
    <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">it_works</span><span style="color: #ff62d4;">()</span> <span style="color: #ff62d4;">{</span>
        <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">result</span> = add<span style="color: #3fdfd0;">(</span>2, 2<span style="color: #3fdfd0;">)</span>;
        <span style="color: #ff9077;">assert_eq!</span><span style="color: #3fdfd0;">(</span>result, 4<span style="color: #3fdfd0;">)</span>;
    <span style="color: #ff62d4;">}</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-org599804c">
<h3 id="org599804c"><code>cargo expand</code></h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #ff9077;">#!</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">feature</span><span style="color: #ff62d4;">(</span><span style="color: #ff9077;">prelude_import</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">]</span>
<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">prelude_import</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">use</span> <span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">prelude</span>::<span style="color: #00bcff;">rust_2021</span>::*;
<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">macro_use</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">extern</span> <span style="color: #b6a0ff;">crate</span> std;
<span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">add</span><span style="color: #ffffff;">(</span><span style="color: #00d3d0;">left</span>: <span style="color: #6ae4b9;">usize</span>, <span style="color: #00d3d0;">right</span>: <span style="color: #6ae4b9;">usize</span><span style="color: #ffffff;">)</span> -&gt; <span style="color: #6ae4b9;">usize</span> <span style="color: #ffffff;">{</span>
    left + right
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-orgbd196ca">
<h3 id="orgbd196ca"><code>cargo expand --lib --tests</code></h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #ff9077;">#!</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">feature</span><span style="color: #ff62d4;">(</span><span style="color: #ff9077;">prelude_import</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">]</span>
<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">prelude_import</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">use</span> <span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">prelude</span>::<span style="color: #00bcff;">rust_2021</span>::*;
<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">macro_use</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">extern</span> <span style="color: #b6a0ff;">crate</span> std;
<span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">add</span><span style="color: #ffffff;">(</span><span style="color: #00d3d0;">left</span>: <span style="color: #6ae4b9;">usize</span>, <span style="color: #00d3d0;">right</span>: <span style="color: #6ae4b9;">usize</span><span style="color: #ffffff;">)</span> -&gt; <span style="color: #6ae4b9;">usize</span> <span style="color: #ffffff;">{</span>
    left + right
<span style="color: #ffffff;">}</span>
<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">cfg</span><span style="color: #ff62d4;">(</span><span style="color: #ff9077;">test</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">mod</span> <span style="color: #00bcff;">tests</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">use</span> <span style="color: #b6a0ff;">super</span>::*;
    <span style="color: #b6a0ff;">extern</span> <span style="color: #b6a0ff;">crate</span> test;
    <span style="color: #ff9077;">#</span><span style="color: #ff62d4;">[</span><span style="color: #ff9077;">cfg</span><span style="color: #3fdfd0;">(</span><span style="color: #ff9077;">test</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">]</span>
    <span style="color: #ff9077;">#</span><span style="color: #ff62d4;">[</span><span style="color: #ff9077;">rustc_test_marker = </span><span style="color: #79a8ff;">"tests::it_works"</span><span style="color: #ff62d4;">]</span>
    <span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">const</span> <span style="color: #00d3d0;">it_works</span>: <span style="color: #00bcff;">test</span>::<span style="color: #6ae4b9;">TestDescAndFn</span> = <span style="color: #00bcff;">test</span>::<span style="color: #6ae4b9;">TestDescAndFn</span> <span style="color: #ff62d4;">{</span>
        <span style="color: #00d3d0;">desc</span>: <span style="color: #00bcff;">test</span>::<span style="color: #6ae4b9;">TestDesc</span> <span style="color: #3fdfd0;">{</span>
            <span style="color: #00d3d0;">name</span>: <span style="color: #00bcff;">test</span>::<span style="color: #6ae4b9;">StaticTestName</span><span style="color: #fba849;">(</span><span style="color: #79a8ff;">"tests::it_works"</span><span style="color: #fba849;">)</span>,
            <span style="color: #00d3d0;">ignore</span>: <span style="color: #b6a0ff;">false</span>,
            <span style="color: #00d3d0;">ignore_message</span>: ::<span style="color: #00bcff;">core</span>::<span style="color: #00bcff;">option</span>::<span style="color: #6ae4b9;">Option</span>::<span style="color: #6ae4b9;">None</span>,
            <span style="color: #00d3d0;">source_file</span>: <span style="color: #79a8ff;">"src/lib.rs"</span>,
            <span style="color: #00d3d0;">start_line</span>: 10<span style="color: #6ae4b9;">usize</span>,
            <span style="color: #00d3d0;">start_col</span>: 8<span style="color: #6ae4b9;">usize</span>,
            <span style="color: #00d3d0;">end_line</span>: 10<span style="color: #6ae4b9;">usize</span>,
            <span style="color: #00d3d0;">end_col</span>: 16<span style="color: #6ae4b9;">usize</span>,
            <span style="color: #00d3d0;">compile_fail</span>: <span style="color: #b6a0ff;">false</span>,
            <span style="color: #00d3d0;">no_run</span>: <span style="color: #b6a0ff;">false</span>,
            <span style="color: #00d3d0;">should_panic</span>: <span style="color: #00bcff;">test</span>::<span style="color: #6ae4b9;">ShouldPanic</span>::<span style="color: #6ae4b9;">No</span>,
            <span style="color: #00d3d0;">test_type</span>: <span style="color: #00bcff;">test</span>::<span style="color: #6ae4b9;">TestType</span>::<span style="color: #6ae4b9;">UnitTest</span>,
        <span style="color: #3fdfd0;">}</span>,
        <span style="color: #00d3d0;">testfn</span>: <span style="color: #00bcff;">test</span>::<span style="color: #6ae4b9;">StaticTestFn</span><span style="color: #3fdfd0;">(</span>
            <span style="color: #ff9077;">#</span><span style="color: #fba849;">[</span><span style="color: #ff9077;">coverage</span><span style="color: #9f80ff;">(</span><span style="color: #ff9077;">off</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">]</span>
            || <span style="color: #00bcff;">test</span>::assert_test_result<span style="color: #fba849;">(</span>it_works<span style="color: #9f80ff;">()</span><span style="color: #fba849;">)</span>,
        <span style="color: #3fdfd0;">)</span>,
    <span style="color: #ff62d4;">}</span>;
    <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">it_works</span><span style="color: #ff62d4;">()</span> <span style="color: #ff62d4;">{</span>
        <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">result</span> = add<span style="color: #3fdfd0;">(</span>2, 2<span style="color: #3fdfd0;">)</span>;
        <span style="color: #b6a0ff;">match</span> <span style="color: #3fdfd0;">(</span><span style="color: #ffffff; background-color: #000000;">&amp;</span>result, <span style="color: #ffffff; background-color: #000000;">&amp;</span>4<span style="color: #3fdfd0;">)</span> <span style="color: #3fdfd0;">{</span>
            <span style="color: #fba849;">(</span>left_val, right_val<span style="color: #fba849;">)</span> =&gt; <span style="color: #fba849;">{</span>
                <span style="color: #b6a0ff;">if</span> !<span style="color: #9f80ff;">(</span>*left_val == *right_val<span style="color: #9f80ff;">)</span> <span style="color: #9f80ff;">{</span>
                    <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">kind</span> = ::<span style="color: #00bcff;">core</span>::<span style="color: #00bcff;">panicking</span>::<span style="color: #6ae4b9;">AssertKind</span>::<span style="color: #6ae4b9;">Eq</span>;
                    ::<span style="color: #00bcff;">core</span>::<span style="color: #00bcff;">panicking</span>::assert_failed<span style="color: #4fe42f;">(</span>
                        kind,
                        <span style="color: #ffffff; background-color: #000000;">&amp;</span>*left_val,
                        <span style="color: #ffffff; background-color: #000000;">&amp;</span>*right_val,
                        ::<span style="color: #00bcff;">core</span>::<span style="color: #00bcff;">option</span>::<span style="color: #6ae4b9;">Option</span>::<span style="color: #6ae4b9;">None</span>,
                    <span style="color: #4fe42f;">)</span>;
                <span style="color: #9f80ff;">}</span>
            <span style="color: #fba849;">}</span>
        <span style="color: #3fdfd0;">}</span>;
    <span style="color: #ff62d4;">}</span>
<span style="color: #ffffff;">}</span>
<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">rustc_main</span><span style="color: #ffffff;">]</span>
<span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">coverage</span><span style="color: #ff62d4;">(</span><span style="color: #ff9077;">off</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">main</span><span style="color: #ffffff;">()</span> -&gt; <span style="color: #ffffff;">()</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">extern</span> <span style="color: #b6a0ff;">crate</span> test;
    <span style="color: #00bcff;">test</span>::test_main_static<span style="color: #ff62d4;">(</span><span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #3fdfd0;">[</span><span style="color: #ffffff; background-color: #000000;">&amp;</span>it_works<span style="color: #3fdfd0;">]</span><span style="color: #ff62d4;">)</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-org15e6bbf">
<h3 id="org15e6bbf">The Test Harness</h3>
<ul>
<li>the default test harness (libtest)</li>
<li>can write our own test harness</li>

</ul>

</section>
<section id="slide-orgfedb6ca">
<h3 id="orgfedb6ca">in Cargo.toml</h3>
<div class="org-src-container">

<pre  class="src src-toml"   ><code trim>[[<span style="color: #6ae4b9;">test</span>]]
<span style="color: #00d3d0;">name</span> = <span style="color: #79a8ff;">"custom"</span>
<span style="color: #00d3d0;">path</span> = <span style="color: #79a8ff;">"tests/custom.rs"</span>
<span style="color: #00d3d0;">harness</span> = <span style="color: #b6a0ff;">false</span>
</code></pre>
</div>

</section>
<section id="slide-org925f087">
<h3 id="org925f087">Arguments to the default test harness</h3>
<ul>
<li><code>--help</code></li>
<li><code>--nocapture</code></li>
<li><code>--test-threads</code></li>
<li>Will have to implement these as well</li>

</ul>

</section>
<section id="slide-orgb3268f8">
<h3 id="orgb3268f8">Why use a custom (or no) test harness</h3>
<ul>
<li>benchmarks</li>
<li>fuzzers</li>
<li>model checkers</li>
<li>custom global set-up (<i>e.g.</i>, WebAssembly)</li>

</ul>

</section>
<section id="slide-org6c5c511">
<h3 id="org6c5c511"><code>#[cfg(test)]</code></h3>
<ul>
<li>compilation context</li>
<li>Caira mentioned last time in Chapter 5</li>
<li>compiler configuration flag <i>test</i></li>
<li><code>rustc --test</code></li>

</ul>

</section>
<section id="slide-org82868db">
<h3 id="org82868db">Mocking</h3>
<ul>
<li>mocks and fakes
<ul>
<li>database connections</li>
<li>network connections</li>

</ul></li>
<li>generics</li>
<li>dedicated struct
<ul>
<li><code>#[cfg(test)]</code></li>
<li><code>#[cfg(feature = "test_mock_foo")]</code></li>

</ul></li>

</ul>

</section>
<section id="slide-org4e61104">
<h3 id="org4e61104"><a href="https://www.youtube.com/watch?v=B81U7Vunhuc">Mocking</a></h3>
<ul>
<li>no standard approach yet</li>
<li><a href="https://crates.io/crates/mockall">mockall</a> crate</li>

</ul>

</section>
<section id="slide-org1c35ff9">
<h3 id="org1c35ff9">Test-Only APIs</h3>
<ul>
<li>First, code that's only for testing</li>

</ul>

</section>
<section id="slide-org4046a13">
<h3 id="org4046a13">testing the hashbrown crate</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">test</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">insert_just_one</span><span style="color: #ffffff;">()</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">let</span> <span style="color: #b6a0ff;">mut</span> <span style="color: #00d3d0;">m</span> = <span style="color: #6ae4b9;">HashMap</span>::new<span style="color: #ff62d4;">()</span>;
    m.insert<span style="color: #ff62d4;">(</span>42, <span style="color: #3fdfd0;">()</span><span style="color: #ff62d4;">)</span>;
    <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">full</span> = m.table.buckets.iter<span style="color: #ff62d4;">()</span>.filter<span style="color: #ff62d4;">(</span><span style="color: #6ae4b9;">Bucket</span>::is_full<span style="color: #ff62d4;">)</span>.count<span style="color: #ff62d4;">()</span>;
    <span style="color: #ff9077;">assert_eq!</span><span style="color: #ff62d4;">(</span>full, 1<span style="color: #ff62d4;">)</span>;
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-orga385160">
<h3 id="orga385160">Private fields</h3>
<ul>
<li>We are testing in <code>HashMap</code></li>
<li>So we can see <code>m.table</code> even though it's private</li>
<li>But <code>RawTable</code> is in another module</li>
<li>So we cannot see <code>m.table.buckets</code></li>

</ul>

</section>
<section id="slide-orge6d8037">
<h3 id="orge6d8037">Create an accessor just for testing</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">impl</span> <span style="color: #6ae4b9;">RawTable</span> <span style="color: #ffffff;">{</span>
    <span style="color: #ff9077;">#</span><span style="color: #ff62d4;">[</span><span style="color: #ff9077;">cfg</span><span style="color: #3fdfd0;">(</span><span style="color: #ff9077;">test</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">]</span>
    <span style="color: #b6a0ff;">pub</span><span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">crate</span><span style="color: #ff62d4;">)</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">buckets</span><span style="color: #ff62d4;">(</span><span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #b6a0ff;">self</span><span style="color: #ff62d4;">)</span> -&gt; <span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #ff62d4;">[</span><span style="color: #6ae4b9;">Bucket</span><span style="color: #ff62d4;">]</span> <span style="color: #ff62d4;">{</span>
        <span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #b6a0ff;">self</span>.buckets
    <span style="color: #ff62d4;">}</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-org17c2475">
<h3 id="org17c2475">Change test to call method</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">test</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">insert_just_one</span><span style="color: #ffffff;">()</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">let</span> <span style="color: #b6a0ff;">mut</span> <span style="color: #00d3d0;">m</span> = <span style="color: #6ae4b9;">HashMap</span>::new<span style="color: #ff62d4;">()</span>;
    m.insert<span style="color: #ff62d4;">(</span>42, <span style="color: #3fdfd0;">()</span><span style="color: #ff62d4;">)</span>;
    <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">full</span> = m.table.buckets<span style="color: #ff62d4;">()</span>.iter<span style="color: #ff62d4;">()</span>.filter<span style="color: #ff62d4;">(</span><span style="color: #6ae4b9;">Bucket</span>::is_full<span style="color: #ff62d4;">)</span>.count<span style="color: #ff62d4;">()</span>;
    <span style="color: #ff9077;">assert_eq!</span><span style="color: #ff62d4;">(</span>full, 1<span style="color: #ff62d4;">)</span>;
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-orge2d14fb">
<h3 id="orge2d14fb">Bookkeeping for Test Assertions</h3>
<ul>
<li>Second, data that's only for testing</li>

</ul>

</section>
<section id="slide-org5fe4ab6">
<h3 id="org5fe4ab6">keep track of writes</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">struct</span> <span style="color: #6ae4b9;">BufWriter</span><span style="color: #ffffff;">&lt;</span><span style="color: #6ae4b9;">T</span><span style="color: #ffffff;">&gt;</span> <span style="color: #ffffff;">{</span>
    <span style="color: #ff9077;">#</span><span style="color: #ff62d4;">[</span><span style="color: #ff9077;">cfg</span><span style="color: #3fdfd0;">(</span><span style="color: #ff9077;">test</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">]</span>
    <span style="color: #00d3d0;">write_through</span>: <span style="color: #6ae4b9;">usize</span>,
    <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">other fields ...</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-org756b6c6">
<h3 id="org756b6c6">keep track of writes</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">struct</span> <span style="color: #6ae4b9;">BufWriter</span><span style="color: #ffffff;">&lt;</span><span style="color: #6ae4b9;">T</span><span style="color: #ffffff;">&gt;</span> <span style="color: #ffffff;">{</span>
    <span style="color: #ff9077;">#</span><span style="color: #ff62d4;">[</span><span style="color: #ff9077;">cfg</span><span style="color: #3fdfd0;">(</span><span style="color: #ff9077;">test</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">]</span>
    <span style="color: #00d3d0;">write_through</span>: <span style="color: #6ae4b9;">usize</span>,
    <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">other fields ...</span>
<span style="color: #ffffff;">}</span>

<span style="color: #b6a0ff;">impl</span><span style="color: #ffffff;">&lt;</span><span style="color: #00d3d0;">T</span>: <span style="color: #6ae4b9;">Write</span><span style="color: #ffffff;">&gt;</span> <span style="color: #6ae4b9;">Write</span> <span style="color: #b6a0ff;">for</span> <span style="color: #6ae4b9;">BufWriter</span><span style="color: #ffffff;">&lt;</span><span style="color: #6ae4b9;">T</span><span style="color: #ffffff;">&gt;</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">write</span><span style="color: #ff62d4;">(</span><span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #b6a0ff;">mut</span> <span style="color: #b6a0ff;">self</span>, <span style="color: #00d3d0;">buf</span>: <span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #3fdfd0;">[</span><span style="color: #6ae4b9;">u8</span><span style="color: #3fdfd0;">]</span><span style="color: #ff62d4;">)</span> -&gt; <span style="color: #6ae4b9;">Result</span><span style="color: #ff62d4;">&lt;</span><span style="color: #6ae4b9;">usize</span><span style="color: #ff62d4;">&gt;</span> <span style="color: #ff62d4;">{</span>
        <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">...</span>
        <span style="color: #b6a0ff;">if</span> <span style="color: #b6a0ff;">self</span>.full<span style="color: #3fdfd0;">()</span> <span style="color: #3fdfd0;">{</span>
            <span style="color: #ff9077;">#</span><span style="color: #fba849;">[</span><span style="color: #ff9077;">cfg</span><span style="color: #9f80ff;">(</span><span style="color: #ff9077;">test</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">]</span>
            <span style="color: #b6a0ff;">self</span>.write_through += 1;
            <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">n</span> = <span style="color: #b6a0ff;">self</span>.inner.write<span style="color: #fba849;">(</span><span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #b6a0ff;">self</span>.buffer<span style="color: #9f80ff;">[</span>..<span style="color: #9f80ff;">]</span><span style="color: #fba849;">)</span><span style="color: #f78fe7; font-weight: bold;">?</span>;
        <span style="color: #3fdfd0;">}</span>
    <span style="color: #ff62d4;">}</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-orgcf8720b">
<h3 id="orgcf8720b">Doctests</h3>

</section>
<section id="slide-org5d1eab0">
<h3 id="org5d1eab0">Docstring for function</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b0d6f5;">/// Completely frobnifies a number through I/O.</span>
<span style="color: #b0d6f5;">///</span>
<span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">frobnify</span><span style="color: #ffffff;">(</span><span style="color: #00d3d0;">i</span>: <span style="color: #6ae4b9;">usize</span><span style="color: #ffffff;">)</span> -&gt; <span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">io</span>::<span style="color: #6ae4b9;">Result</span><span style="color: #ffffff;">&lt;</span><span style="color: #ff62d4;">()</span><span style="color: #ffffff;">&gt;</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">if</span> i == 0 <span style="color: #ff62d4;">{</span>
        <span style="color: #b6a0ff;">return</span> <span style="color: #6ae4b9;">Ok</span><span style="color: #3fdfd0;">(</span><span style="color: #fba849;">()</span><span style="color: #3fdfd0;">)</span>;
    <span style="color: #ff62d4;">}</span>
    <span style="color: #6ae4b9;">Err</span><span style="color: #ff62d4;">(</span><span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">io</span>::<span style="color: #6ae4b9;">Error</span>::new<span style="color: #3fdfd0;">(</span><span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">io</span>::<span style="color: #6ae4b9;">ErrorKind</span>::<span style="color: #6ae4b9;">Other</span>, <span style="color: #79a8ff;">"error"</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>


</section>
<section id="slide-org6e3345e">
<h3 id="org6e3345e">Add code in triple backticks</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b0d6f5;">/// Completely frobnifies a number through I/O.</span>
<span style="color: #b0d6f5;">///</span>
<span style="color: #b0d6f5;">/// ```</span>
<span style="color: #b0d6f5;">/// # use mylib::frobnify;</span>
<span style="color: #b0d6f5;">/// # let unfrobnified_number = 0;</span>
<span style="color: #b0d6f5;">/// # let already_frobnified = 1;</span>
<span style="color: #b0d6f5;">/// assert!(frobnify(unfrobnified_number).is_ok());</span>
<span style="color: #b0d6f5;">/// assert!(frobnify(already_frobnified).is_err());</span>
<span style="color: #b0d6f5;">/// ```</span>
<span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">frobnify</span><span style="color: #ffffff;">(</span><span style="color: #00d3d0;">i</span>: <span style="color: #6ae4b9;">usize</span><span style="color: #ffffff;">)</span> -&gt; <span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">io</span>::<span style="color: #6ae4b9;">Result</span><span style="color: #ffffff;">&lt;</span><span style="color: #ff62d4;">()</span><span style="color: #ffffff;">&gt;</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">if</span> i == 0 <span style="color: #ff62d4;">{</span>
        <span style="color: #b6a0ff;">return</span> <span style="color: #6ae4b9;">Ok</span><span style="color: #3fdfd0;">(</span><span style="color: #fba849;">()</span><span style="color: #3fdfd0;">)</span>;
    <span style="color: #ff62d4;">}</span>
    <span style="color: #6ae4b9;">Err</span><span style="color: #ff62d4;">(</span><span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">io</span>::<span style="color: #6ae4b9;">Error</span>::new<span style="color: #3fdfd0;">(</span><span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">io</span>::<span style="color: #6ae4b9;">ErrorKind</span>::<span style="color: #6ae4b9;">Other</span>, <span style="color: #79a8ff;">"error"</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-org148fcfd">
<h3 id="org148fcfd">Everything in backticks is Rust code</h3>
<ul>
<li>automatically run as doctests</li>
<li>integration tests
<ul>
<li>no private fields or methods</li>
<li><code>test</code> is not set on main</li>

</ul></li>
<li>each test gets its own <code>fn main</code>
<ul>
<li>(can opt out of this)</li>

</ul></li>

</ul>

</section>
<section id="slide-org9c5db5f">
<h3 id="org9c5db5f">Must use the function you're testing</h3>
<ul>
<li>Can hide code with #</li>
<li><code>/// # use mylib::frobnify;</code></li>

</ul>

</section>
<section id="slide-org4f37f6e">
<h3 id="org4f37f6e">Results</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b0d6f5;">/// Here's an example that uses ? on multiple types</span>
<span style="color: #b0d6f5;">/// and thus needs to declare the concrete error type,</span>
<span style="color: #b0d6f5;">/// but we don't want to distract the user with that.</span>
<span style="color: #b0d6f5;">/// we also hide the use that brings the function into scope.</span>
<span style="color: #b0d6f5;">/// ```</span>
<span style="color: #b0d6f5;">/// # use mylib::frobnify;</span>
<span style="color: #b0d6f5;">/// # let unfrobnified_number = 0;</span>
<span style="color: #b0d6f5;">/// frobnify("0".parse()?)?;</span>
<span style="color: #b0d6f5;">/// # Ok::&lt;(), anyhow::Error&gt;(())</span>
<span style="color: #b0d6f5;">/// ```</span>
</code></pre>
</div>

</section>
<section id="slide-org3370620">
<h3 id="org3370620">This example depends on <code>anyhow</code></h3>
<ul>
<li>Cargo.toml</li>

</ul>
<div class="org-src-container">

<pre  class="src src-toml"   ><code trim>[<span style="color: #6ae4b9;">dev-dependencies</span>]
<span style="color: #00d3d0;">anyhow</span> = <span style="color: #79a8ff;">"1.0"</span>
</code></pre>
</div>

</section>
<section id="slide-org2647a98">
<h3 id="org2647a98">Block comments</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b0d6f5;">/// You could even replace an entire block of code completely,</span>
<span style="color: #b0d6f5;">/// though use this _very_ sparingly.</span>
<span style="color: #b0d6f5;">/// ```</span>
<span style="color: #b0d6f5;">/// # use mylib::frobnify;</span>
<span style="color: #b0d6f5;">/// # /*</span>
<span style="color: #b0d6f5;">/// let i = ...;</span>
<span style="color: #b0d6f5;">/// # */</span>
<span style="color: #b0d6f5;">/// # let i = 42;</span>
<span style="color: #b0d6f5;">/// frobnify(i)?;</span>
<span style="color: #b0d6f5;">/// # Ok::&lt;(), anyhow::Error&gt;(())</span>
<span style="color: #b0d6f5;">/// ```</span>
</code></pre>
</div>

</section>
<section id="slide-org04db9b9">
<h3 id="org04db9b9">Irony!</h3>
<blockquote >
<p>
NOTE: Use this feature with care; it can be frustrating to users if they copy-paste an example and then it doesn't work because of required steps that you've hidden.
</p>
</blockquote>

</section>
<section id="slide-orgc160c96">
<h3 id="orgc160c96">Attributes</h3>
<ul>
<li><code>should_panic</code>, <code>ignore</code>, <code>no_run</code></li>
<li>This code should fail to compile</li>

</ul>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b0d6f5;">/// ```compile_fail</span>
<span style="color: #b0d6f5;">/// # struct MyNonSendType(std::rc::Rc&lt;()&gt;);</span>
<span style="color: #b0d6f5;">/// fn is_send&lt;T: Send&gt;() {}</span>
<span style="color: #b0d6f5;">/// is_send::&lt;MyNonSendType&gt;();</span>
<span style="color: #b0d6f5;">/// ```</span>
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orgb154e84">
<h2 id="orgb154e84">Additional Testing Tools</h2>
<div class="outline-text-2" id="text-orgb154e84">
</div>
</section>
<section id="slide-orgb42f896">
<h3 id="orgb42f896">Linting</h3>
<ul>
<li>clippy
<ul>
<li>correctness lints</li>
<li>other lints</li>

</ul></li>
<li>rustc
<ul>
<li>warnings</li>
<li>(correctness lints are "errors")</li>
<li><code>rustc -W help</code></li>

</ul></li>

</ul>
</section>
<section id="slide-orgfb1f5e1">
<h3 id="orgfb1f5e1">rustc warnings</h3>
<ul>
<li>Not all are on by default!</li>
<li><code>rust_2018_idioms</code></li>
<li><code>missing_docs</code>
<ul>
<li>public, but no docstring</li>

</ul></li>
<li><code>missing_debug_implementations</code>
<ul>
<li>public, but no <code>Debug</code></li>

</ul></li>

</ul>

</section>
<section id="slide-orgbeb5772">
<h3 id="orgbeb5772">rustc warnings</h3>
<ul>
<li>enable warning
<ul>
<li><code>#![warn(missing_docs)]</code></li>

</ul></li>
<li>convert warning to error
<ul>
<li><code>#![deny(missing_docs)]</code></li>

</ul></li>

</ul>

</section>
<section id="slide-org6d06ded">
<h3 id="org6d06ded">Test Generation</h3>
<ul>
<li>Fuzzing
<ul>
<li><a href="https://rust-fuzz.github.io/book/cargo-fuzz.html">cargo-fuzz</a></li>
<li><a href="https://github.com/rust-fuzz/libfuzzer">libfuzzer-sys</a> (LLVM's libFuzzer)</li>

</ul></li>
<li>Property-Based Testing
<ul>
<li><a href="https://proptest-rs.github.io/proptest/proptest/index.html">proptest</a></li>
<li><a href="https://docs.rs/quickcheck/latest/quickcheck/">quickcheck</a></li>

</ul></li>

</ul>

</section>
<section id="slide-orgc127d71">
<h3 id="orgc127d71"><a href="https://www.cse.chalmers.se/~rjmh/QuickCheck/">QuickCheck</a></h3>

<div id="org3c9fe50" class="figure">
<p><img src="./claessen-hughes.jpg" alt="claessen-hughes.jpg" />
</p>
</div>

</section>
<section id="slide-org22617aa">
<h3 id="org22617aa"><a href="https://www.cse.chalmers.se/~rjmh/QuickCheck/">QuickCheck</a></h3>
<ul>
<li>by <a href="https://www.cse.chalmers.se/~koen/">Koen Claessen</a> and <a href="https://www.cse.chalmers.se/~rjmh/">John Hughes</a></li>
<li>originated in Haskell in 1999</li>
<li>John Hughes <a href="https://www.youtube.com/results?search_query=john+hughes+quickcheck">talks on quickcheck</a></li>
<li>shrinking!</li>

</ul>

</section>
<section id="slide-orgaaf1115">
<h3 id="orgaaf1115"><a href="https://ericnormand.me/issues/purelyfunctional-tv-newsletter-459-revisiting-the-open-closed-principle">Paul Cipher</a></h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">use</span> <span style="color: #00bcff;">proptest</span>::<span style="color: #00bcff;">prelude</span>::*;
<span style="color: #ff9077;">proptest!</span> <span style="color: #ffffff;">{</span>
    <span style="color: #ff9077;">#</span><span style="color: #ff62d4;">[</span><span style="color: #ff9077;">test</span><span style="color: #ff62d4;">]</span>
    <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">r"\PC*" is a regex which generates a string of arbitrary non-control characters.</span>
    <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">encode_then_decode</span><span style="color: #ff62d4;">(</span>s <span style="color: #b6a0ff;">in</span> <span style="color: #79a8ff;">r"\PC*"</span><span style="color: #ff62d4;">)</span> <span style="color: #ff62d4;">{</span>
        <span style="color: #ff9077;">prop_assert_eq!</span><span style="color: #3fdfd0;">(</span>decode<span style="color: #fba849;">(</span><span style="color: #ffffff; background-color: #000000;">&amp;</span>encode<span style="color: #9f80ff;">(</span><span style="color: #ffffff; background-color: #000000;">&amp;</span>s<span style="color: #9f80ff;">)</span><span style="color: #fba849;">)</span>, s.to_ascii_uppercase<span style="color: #fba849;">()</span><span style="color: #3fdfd0;">)</span>;
    <span style="color: #ff62d4;">}</span>
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-orgf8391f7">
<h3 id="orgf8391f7">proptest =&gt; unit test</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #ff9077;">#</span><span style="color: #ffffff;">[</span><span style="color: #ff9077;">test</span><span style="color: #ffffff;">]</span>
<span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">test_encode</span><span style="color: #ffffff;">()</span> <span style="color: #ffffff;">{</span>
    <span style="color: #ff9077;">assert_eq!</span><span style="color: #ff62d4;">(</span>encode<span style="color: #3fdfd0;">(</span><span style="color: #79a8ff;">""</span><span style="color: #3fdfd0;">)</span>, <span style="color: #79a8ff;">""</span><span style="color: #ff62d4;">)</span>;
    <span style="color: #ff9077;">assert_eq!</span><span style="color: #ff62d4;">(</span>encode<span style="color: #3fdfd0;">(</span><span style="color: #79a8ff;">"a"</span><span style="color: #3fdfd0;">)</span>, <span style="color: #79a8ff;">"A"</span><span style="color: #ff62d4;">)</span>;
    <span style="color: #ff9077;">assert_eq!</span><span style="color: #ff62d4;">(</span>encode<span style="color: #3fdfd0;">(</span><span style="color: #79a8ff;">"hello"</span><span style="color: #3fdfd0;">)</span>, <span style="color: #79a8ff;">"HMQXA"</span><span style="color: #ff62d4;">)</span>;
    <span style="color: #ff9077;">assert_eq!</span><span style="color: #ff62d4;">(</span>encode<span style="color: #3fdfd0;">(</span><span style="color: #79a8ff;">"newsletter"</span><span style="color: #3fdfd0;">)</span>, <span style="color: #79a8ff;">"NSBPEQYNYW"</span><span style="color: #ff62d4;">)</span>;
    <span style="color: #ff9077;">assert_eq!</span><span style="color: #ff62d4;">(</span>encode<span style="color: #3fdfd0;">(</span><span style="color: #79a8ff;">"1 hug"</span><span style="color: #3fdfd0;">)</span>, <span style="color: #79a8ff;">"1 HCB"</span><span style="color: #ff62d4;">)</span>;

    <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">proptest found this one!</span>
    <span style="color: #ff9077;">assert_eq!</span><span style="color: #ff62d4;">(</span>encode<span style="color: #3fdfd0;">(</span><span style="color: #79a8ff;">"z"</span><span style="color: #3fdfd0;">)</span>, <span style="color: #79a8ff;">"Z"</span><span style="color: #ff62d4;">)</span>;
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-org1b8b090">
<h3 id="org1b8b090">fuzzing =~ property-based testing</h3>
<blockquote >
<p>
If this approach of generating inputs until some condition is met sounds a lot like fuzzing, that's because it is&#x2014; smarter people than I have argued that fuzzing is "just" property-based testing where the property you're testing for is "it doesn't crash."
</p>
</blockquote>

</section>
<section id="slide-org463037c">
<h3 id="org463037c">Testing Sequences of Operations</h3>
<ul>
<li>not limited to a single function call</li>
<li>can test, say, a whole <code>Vec&lt;Operation&gt;</code></li>
<li>minimizers can still find the smallest sequence</li>

</ul>

</section>
<section id="slide-orged1996a">
<h3 id="orged1996a">Test Augmentation</h3>
<ul>
<li>difficult to test for rare failures
<ul>
<li>only if on different threads</li>
<li>UB in <code>unsafe</code> code</li>

</ul></li>
<li>could try repeating test</li>

</ul>

</section>
<section id="slide-orgd9ec5c7">
<h3 id="orgd9ec5c7">Test Augmentation</h3>
<ul>
<li><a href="https://github.com/rust-lang/miri">Miri</a>
<ul>
<li>mid-level intermediate representation (MIR)</li>

</ul></li>
<li><a href="https://docs.rs/loom/latest/loom/">Loom</a>
<ul>
<li><a href="http://demsky.eecs.uci.edu/publications/c11modelcheck.pdf">CDSChecker</a>: Checking Concurrent Data Structures Written with C/C++ Atomics</li>

</ul></li>

</ul>

</section>
<section id="slide-org9d9eaa4">
<h3 id="org9d9eaa4">Miri</h3>
<ul>
<li>rustup +nightly component add miri</li>
<li>cargo +nightly miri test</li>
<li>cargo +nightly miri run</li>

</ul>

</section>
<section id="slide-orgec48f40">
<h3 id="orgec48f40">Miri</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">main</span><span style="color: #ffffff;">()</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">let</span> <span style="color: #b6a0ff;">mut</span> <span style="color: #00d3d0;">x</span> = 42;
    <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">x</span>: *<span style="color: #b6a0ff;">mut</span> <span style="color: #6ae4b9;">i32</span> = <span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #b6a0ff;">mut</span> x;
    <span style="color: #b6a0ff;">let</span> <span style="color: #ff62d4;">(</span>x1, x2<span style="color: #ff62d4;">)</span> = <span style="color: #d0bc00;">unsafe</span> <span style="color: #ff62d4;">{</span> <span style="color: #3fdfd0;">(</span><span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #b6a0ff;">mut</span> *x, <span style="color: #ffffff; background-color: #000000;">&amp;</span><span style="color: #b6a0ff;">mut</span> *x<span style="color: #3fdfd0;">)</span> <span style="color: #ff62d4;">}</span>;
    <span style="color: #f78fe7;">println!</span><span style="color: #ff62d4;">(</span><span style="color: #79a8ff;">"</span><span style="color: #79a8ff; font-style: italic;">{}</span><span style="color: #79a8ff;"> </span><span style="color: #79a8ff; font-style: italic;">{}</span><span style="color: #79a8ff;">"</span>, x1, x2<span style="color: #ff62d4;">)</span>;
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-orgf502f86">
<h3 id="orgf502f86">Miri</h3>
<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>&#10095; cargo +nightly run
   Compiling use-miri v0.1.0 <span style="color: #ffffff;">(</span>/home/tim/rust/use-miri<span style="color: #ffffff;">)</span>
    Finished <span style="color: #f78fe7;">`dev`</span> profile <span style="color: #ffffff;">[</span>unoptimized + debuginfo<span style="color: #ffffff;">]</span> target<span style="color: #ffffff;">(</span>s<span style="color: #ffffff;">)</span> <span style="color: #b6a0ff;">in</span> 0.34s
     Running <span style="color: #f78fe7;">`/home/tim/rust/target/debug/use-miri`</span>
42 42
</code></pre>
</div>

</section>
<section id="slide-orgbb80b31">
<h3 id="orgbb80b31">Miri</h3>
<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>&#10095; cargo +nightly miri run
Preparing a sysroot for Miri <span style="color: #ffffff;">(</span>target: x86_64-unknown-linux-gnu<span style="color: #ffffff;">)</span>... done
   Compiling use-miri v0.1.0 <span style="color: #ffffff;">(</span>/home/tim/rust/use-miri<span style="color: #ffffff;">)</span>
    Finished <span style="color: #f78fe7;">`dev`</span> profile <span style="color: #ffffff;">[</span>unoptimized + debuginfo<span style="color: #ffffff;">]</span> target<span style="color: #ffffff;">(</span>s<span style="color: #ffffff;">)</span> <span style="color: #b6a0ff;">in</span> 0.03s
     Running <span style="color: #f78fe7;">`/home/tim/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/cargo-miri runner /home/tim/rust/target/miri/x86_64-unknown-linux-gnu/debug/use-miri`</span>
error: Undefined Behavior: trying to retag from &lt;2377&gt; for Unique permission at alloc1137<span style="color: #ffffff;">[</span>0x0<span style="color: #ffffff;">]</span>, but that tag does not exist<span style="color: #b6a0ff;"> in</span> the borrow stack for this location
 --&gt; src/main.rs:4:29
  |
4 |     <span style="color: #f78fe7;">let</span> <span style="color: #ffffff;">(</span>x1, x2<span style="color: #ffffff;">)</span> = unsafe <span style="color: #ffffff;">{</span> <span style="color: #ff62d4;">(</span>&amp;mut *x, &amp;mut *x<span style="color: #ff62d4;">)</span> <span style="color: #ffffff;">}</span>;
  |                             ^^^^^^^^^^^^^^^^^^
  |                             |
  |                             trying to retag from &lt;2377&gt; for Unique permission at alloc1137<span style="color: #ffffff;">[</span>0x0<span style="color: #ffffff;">]</span>, but that tag does not exist<span style="color: #b6a0ff;"> in</span> the borrow stack for this location
  |                             this error occurs as part of retag <span style="color: #ffffff;">(</span>of a reference/box inside this compound value<span style="color: #ffffff;">)</span> at alloc1137<span style="color: #ffffff;">[</span>0x0..0x4<span style="color: #ffffff;">]</span>
  |                             errors for retagging<span style="color: #b6a0ff;"> in</span> fields are fairly new; please reach out to us <span style="color: #ffffff;">(</span>e.g. at <a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">&lt;https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;</a><span style="color: #ffffff;"><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">)</a></span><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --"> </a><span style="color: #b6a0ff;"><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">if</a></span><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --"> you find this error troubling
  |
  = help: this indicates a potential bug</a><span style="color: #b6a0ff;"><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --"> in</a></span><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --"> the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
</a><span style="color: #f78fe7;"><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">help</a></span><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">: &lt;2377&gt; was created by a Unique retag at offsets </a><span style="color: #ffffff;"><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">[</a></span><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">0x0..0x4</a><span style="color: #ffffff;"><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">]</a></span><a href="https://rust-lang.zulipchat.com/#narrow/stream/269128-miri&gt;) if you find this error troubling
  |
  = help: this indicates a potential bug in the program: it performed an invalid operation, but the Stacked Borrows rules it violated are still experimental
  = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information
help: &lt;2377&gt; was created by a Unique retag at offsets [0x0..0x4]
 --">
 --&gt;</a> src/main.rs:4:30
  |
4 |     <span style="color: #f78fe7;">let</span> <span style="color: #ffffff;">(</span>x1, x2<span style="color: #ffffff;">)</span> = unsafe <span style="color: #ffffff;">{</span> <span style="color: #ff62d4;">(</span>&amp;mut *x, &amp;mut *x<span style="color: #ff62d4;">)</span> <span style="color: #ffffff;">}</span>;
  |                              ^^^^^^^
<span style="color: #f78fe7;">help</span>: &lt;2377&gt; was later invalidated at offsets <span style="color: #ffffff;">[</span>0x0..0x4<span style="color: #ffffff;">]</span> by a Unique retag
 --&gt; src/main.rs:4:39
  |
4 |     <span style="color: #f78fe7;">let</span> <span style="color: #ffffff;">(</span>x1, x2<span style="color: #ffffff;">)</span> = unsafe <span style="color: #ffffff;">{</span> <span style="color: #ff62d4;">(</span>&amp;mut *x, &amp;mut *x<span style="color: #ff62d4;">)</span> <span style="color: #ffffff;">}</span>;
  |                                       ^^^^^^^
  = note: BACKTRACE <span style="color: #ffffff;">(</span>of the first span<span style="color: #ffffff;">)</span>:
  = note: inside <span style="color: #f78fe7;">`main`</span> at src/main.rs:4:29: 4:47

note: some details are omitted, run with <span style="color: #f78fe7;">`MIRIFLAGS=-Zmiri-backtrace=full`</span> <span style="color: #b6a0ff;">for</span> a verbose backtrace

error: aborting due to 1 previous error
</code></pre>
</div>

</section>
<section id="slide-org92fee85">
<h3 id="org92fee85">Performance Testing</h3>
<ul>
<li>Performance Variance</li>
<li>Compiler Optimizations</li>
<li>I/O Overhead Measurement</li>

</ul>

</section>
<section id="slide-org287a015">
<h3 id="org287a015">Performance Variance</h3>
<ul>
<li><a href="https://docs.rs/hdrhistogram/latest/hdrhistogram/">hdrhistogram</a> (high dynamic range histogram)
<ul>
<li>port of <a href="https://hdrhistogram.github.io/HdrHistogram/">HdrHistogram</a> Java library</li>

</ul></li>
<li><a href="https://crates.io/crates/criterion">criterion</a>
<ul>
<li><a href="https://doc.rust-lang.org/cargo/commands/cargo-bench.html">cargo bench</a></li>
<li><code>$PROJECT/benches</code></li>

</ul></li>

</ul>

</section>
<section id="slide-org4cd2088">
<h3 id="org4cd2088">Compiler Optimizations</h3>
<ul>
<li class="fragment appear"><a href="https://godbolt.org/">godbolt.org</a> ("Compiler Explorer")</li>
<li class="fragment appear"><del>cargo-asm</del> <a href="https://docs.rs/cargo-show-asm/latest/cargo_show_asm/">cargo-show-asm</a>
<ul>
<li>command is still "cargo asm"</li>

</ul></li>
<li class="fragment appear"><a href="https://doc.rust-lang.org/std/hint/fn.black_box.html"><code>std::hint::black_box</code></a>
<ul>
<li>stabilized in <a href="https://github.com/rust-lang/rust/blob/stable/RELEASES.md#version-1660-2022-12-15">version 1.66</a> (2022-12-15)</li>

</ul></li>

</ul>

</section>
<section id="slide-orga61749f">
<h3 id="orga61749f">cargo-show-asm</h3>
<p>
cargo install cargo-show-asm
</p>

</section>
<section id="slide-org8310839">
<h3 id="org8310839">cargo-show-asm</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">vec_push</span><span style="color: #ffffff;">()</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">let</span> <span style="color: #b6a0ff;">mut</span> <span style="color: #00d3d0;">vs</span> = <span style="color: #6ae4b9;">Vec</span>::with_capacity<span style="color: #ff62d4;">(</span>4<span style="color: #ff62d4;">)</span>;
    <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">start</span> = <span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">time</span>::<span style="color: #6ae4b9;">Instant</span>::now<span style="color: #ff62d4;">()</span>;
    <span style="color: #b6a0ff;">for</span> <span style="color: #00d3d0;">i</span> <span style="color: #b6a0ff;">in</span> 0..4 <span style="color: #ff62d4;">{</span>
        vs.push<span style="color: #3fdfd0;">(</span>i<span style="color: #3fdfd0;">)</span>;
    <span style="color: #ff62d4;">}</span>
    <span style="color: #f78fe7;">println!</span><span style="color: #ff62d4;">(</span><span style="color: #79a8ff;">"took </span><span style="color: #79a8ff; font-style: italic;">{:?}</span><span style="color: #79a8ff;">"</span>, start.elapsed<span style="color: #3fdfd0;">()</span><span style="color: #ff62d4;">)</span>;
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-orgf8b2919">
<h3 id="orgf8b2919">cargo-show-asm</h3>
<p>
<code>cargo asm vec_push</code>
</p>
<div class="org-src-container">

<pre  class="src src-asm"   ><code trim><span style="color: #b6a0ff;">.section</span> .text.mylib::vec_push,<span style="color: #79a8ff;">"ax"</span>,@progbits
        <span style="color: #b6a0ff;">.globl</span>  mylib::vec_push
        <span style="color: #b6a0ff;">.p2align</span>        4, 0x90
        <span style="color: #b6a0ff;">.type</span>   mylib::vec_push,@function
<span style="color: #feacd0;">mylib</span>::vec_push:
        <span style="color: #b6a0ff;">.cfi_startproc</span>
        <span style="color: #b6a0ff;">sub</span> rsp, 104
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 112
        <span style="color: #b6a0ff;">mov</span> rax, qword ptr <span style="color: #ffffff;">[</span>rip + __rust_no_alloc_shim_is_unstable@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">movzx</span> eax, byte ptr <span style="color: #ffffff;">[</span>rax<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + std::time::Instant::now@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> dword ptr <span style="color: #ffffff;">[</span>rsp + 16<span style="color: #ffffff;">]</span>, edx
        <span style="color: #b6a0ff;">lea</span> rdi, <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + std::time::Instant::elapsed@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 40<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> dword ptr <span style="color: #ffffff;">[</span>rsp + 48<span style="color: #ffffff;">]</span>, edx
        <span style="color: #b6a0ff;">lea</span> rax, <span style="color: #ffffff;">[</span>rsp + 40<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 24<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> rax, qword ptr <span style="color: #ffffff;">[</span>rip + &lt;core::time::Duration as core::fmt::Debug&gt;::fmt@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 32<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">lea</span> rax, <span style="color: #ffffff;">[</span>rip + .L__unnamed_1<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 56<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 64<span style="color: #ffffff;">]</span>, 2
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 88<span style="color: #ffffff;">]</span>, 0
        <span style="color: #b6a0ff;">lea</span> rax, <span style="color: #ffffff;">[</span>rsp + 24<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 72<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 80<span style="color: #ffffff;">]</span>, 1
        <span style="color: #b6a0ff;">lea</span> rdi, <span style="color: #ffffff;">[</span>rsp + 56<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + std::io::stdio::_print@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">add</span> rsp, 104
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 8
        <span style="color: #b6a0ff;">ret</span>

======================= Additional context =========================

<span style="color: #b6a0ff;">.section</span> .rodata..L__unnamed_2,<span style="color: #79a8ff;">"a"</span>,@progbits
        <span style="color: #b6a0ff;">.ascii</span>  <span style="color: #79a8ff;">"took "</span>
        <span style="color: #b6a0ff;">.size</span>   .L__unnamed_2, 5

<span style="color: #b6a0ff;">.section</span> .rodata..L__unnamed_3,<span style="color: #79a8ff;">"a"</span>,@progbits
        <span style="color: #b6a0ff;">.byte</span>   10
        <span style="color: #b6a0ff;">.size</span>   .L__unnamed_3, 1

<span style="color: #b6a0ff;">.section</span> .data.rel.ro..L__unnamed_1,<span style="color: #79a8ff;">"aw"</span>,@progbits
        <span style="color: #b6a0ff;">.p2align</span>        3, 0x0
        <span style="color: #b6a0ff;">.quad</span>   .L__unnamed_2
        <span style="color: #b6a0ff;">.asciz</span>  <span style="color: #79a8ff;">"\005\000\000\000\000\000\000"</span>
        <span style="color: #b6a0ff;">.quad</span>   .L__unnamed_3
        <span style="color: #b6a0ff;">.asciz</span>  <span style="color: #79a8ff;">"\001\000\000\000\000\000\000"</span>
        <span style="color: #b6a0ff;">.size</span>   .L__unnamed_1, 32
</code></pre>
</div>

</section>
<section id="slide-org6019997">
<h3 id="org6019997"><code>black_box</code></h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">use</span> <span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">hint</span>::black_box;
<span style="color: #b6a0ff;">pub</span> <span style="color: #b6a0ff;">fn</span> <span style="color: #feacd0;">vec_push</span><span style="color: #ffffff;">()</span> <span style="color: #ffffff;">{</span>
    <span style="color: #b6a0ff;">let</span> <span style="color: #b6a0ff;">mut</span> <span style="color: #00d3d0;">vs</span> = <span style="color: #6ae4b9;">Vec</span>::with_capacity<span style="color: #ff62d4;">(</span>4<span style="color: #ff62d4;">)</span>;
    <span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">start</span> = <span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">time</span>::<span style="color: #6ae4b9;">Instant</span>::now<span style="color: #ff62d4;">()</span>;
    <span style="color: #b6a0ff;">for</span> <span style="color: #00d3d0;">i</span> <span style="color: #b6a0ff;">in</span> 0..4 <span style="color: #ff62d4;">{</span>
        black_box<span style="color: #3fdfd0;">(</span>vs.as_ptr<span style="color: #fba849;">()</span><span style="color: #3fdfd0;">)</span>;
        vs.push<span style="color: #3fdfd0;">(</span>i<span style="color: #3fdfd0;">)</span>;
        black_box<span style="color: #3fdfd0;">(</span>vs.as_ptr<span style="color: #fba849;">()</span><span style="color: #3fdfd0;">)</span>;
    <span style="color: #ff62d4;">}</span>
    <span style="color: #f78fe7;">println!</span><span style="color: #ff62d4;">(</span><span style="color: #79a8ff;">"took </span><span style="color: #79a8ff; font-style: italic;">{:?}</span><span style="color: #79a8ff;">"</span>, start.elapsed<span style="color: #3fdfd0;">()</span><span style="color: #ff62d4;">)</span>;
<span style="color: #ffffff;">}</span>
</code></pre>
</div>

</section>
<section id="slide-orgc0deefe">
<h3 id="orgc0deefe"><code>black_box</code> asm</h3>
<div class="org-src-container">

<pre  class="src src-asm"   ><code trim><span style="color: #b6a0ff;">.section</span> .text.mylib::vec_push,<span style="color: #79a8ff;">"ax"</span>,@progbits
        <span style="color: #b6a0ff;">.globl</span>  mylib::vec_push
        <span style="color: #b6a0ff;">.p2align</span>        4, 0x90
        <span style="color: #b6a0ff;">.type</span>   mylib::vec_push,@function
<span style="color: #feacd0;">mylib</span>::vec_push:
        <span style="color: #b6a0ff;">.cfi_startproc</span>
        <span style="color: #b6a0ff;">.cfi_personality</span> 155, DW.ref.rust_eh_personality
        <span style="color: #b6a0ff;">.cfi_lsda</span> 27, .Lexception0
        <span style="color: #b6a0ff;">push</span> r14
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 16
        <span style="color: #b6a0ff;">push</span> rbx
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 24
        <span style="color: #b6a0ff;">sub</span> rsp, 104
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 128
        <span style="color: #b6a0ff;">.cfi_offset</span> rbx, -24
        <span style="color: #b6a0ff;">.cfi_offset</span> r14, -16
        <span style="color: #b6a0ff;">mov</span> rax, qword ptr <span style="color: #ffffff;">[</span>rip + __rust_no_alloc_shim_is_unstable@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">movzx</span> eax, byte ptr <span style="color: #ffffff;">[</span>rax<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> edi, 16
        <span style="color: #b6a0ff;">mov</span> esi, 4
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + __rust_alloc@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">test</span> rax, rax
        <span style="color: #b6a0ff;">je</span> .LBB0_6
        <span style="color: #b6a0ff;">mov</span> rbx, rax
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + std::time::Instant::now@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 56<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> dword ptr <span style="color: #ffffff;">[</span>rsp + 64<span style="color: #ffffff;">]</span>, edx
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rbx
        <span style="color: #b6a0ff;">lea</span> rax, <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>
        #APP
        #NO_APP
        <span style="color: #b6a0ff;">mov</span> dword ptr <span style="color: #ffffff;">[</span>rbx<span style="color: #ffffff;">]</span>, 0
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rbx
        <span style="color: #b6a0ff;">lea</span> rcx, <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>
        #APP
        #NO_APP
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rbx
        #APP
        #NO_APP
        <span style="color: #b6a0ff;">mov</span> dword ptr <span style="color: #ffffff;">[</span>rbx + 4<span style="color: #ffffff;">]</span>, 1
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rbx
        #APP
        #NO_APP
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rbx
        #APP
        #NO_APP
        <span style="color: #b6a0ff;">mov</span> dword ptr <span style="color: #ffffff;">[</span>rbx + 8<span style="color: #ffffff;">]</span>, 2
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rbx
        #APP
        #NO_APP
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rbx
        #APP
        #NO_APP
        <span style="color: #b6a0ff;">mov</span> dword ptr <span style="color: #ffffff;">[</span>rbx + 12<span style="color: #ffffff;">]</span>, 3
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rbx
        #APP
        #NO_APP
        <span style="color: #b6a0ff;">lea</span> rdi, <span style="color: #ffffff;">[</span>rsp + 56<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + std::time::Instant::elapsed@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 88<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> dword ptr <span style="color: #ffffff;">[</span>rsp + 96<span style="color: #ffffff;">]</span>, edx
        <span style="color: #b6a0ff;">lea</span> rax, <span style="color: #ffffff;">[</span>rsp + 88<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 72<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> rax, qword ptr <span style="color: #ffffff;">[</span>rip + &lt;core::time::Duration as core::fmt::Debug&gt;::fmt@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 80<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">lea</span> rax, <span style="color: #ffffff;">[</span>rip + .L__unnamed_1<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 16<span style="color: #ffffff;">]</span>, 2
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 40<span style="color: #ffffff;">]</span>, 0
        <span style="color: #b6a0ff;">lea</span> rax, <span style="color: #ffffff;">[</span>rsp + 72<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 24<span style="color: #ffffff;">]</span>, rax
        <span style="color: #b6a0ff;">mov</span> qword ptr <span style="color: #ffffff;">[</span>rsp + 32<span style="color: #ffffff;">]</span>, 1
        <span style="color: #b6a0ff;">lea</span> rdi, <span style="color: #ffffff;">[</span>rsp + 8<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + std::io::stdio::_print@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> esi, 16
        <span style="color: #b6a0ff;">mov</span> edx, 4
        <span style="color: #b6a0ff;">mov</span> rdi, rbx
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + __rust_dealloc@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">add</span> rsp, 104
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 24
        <span style="color: #b6a0ff;">pop</span> rbx
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 16
        <span style="color: #b6a0ff;">pop</span> r14
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 8
        <span style="color: #b6a0ff;">ret</span>
<span style="color: #feacd0;">.LBB0_6</span>:
        <span style="color: #b6a0ff;">.cfi_def_cfa_offset</span> 128
        <span style="color: #b6a0ff;">mov</span> edi, 4
        <span style="color: #b6a0ff;">mov</span> esi, 16
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + alloc::alloc::handle_alloc_error@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> r14, rax
        <span style="color: #b6a0ff;">mov</span> esi, 16
        <span style="color: #b6a0ff;">mov</span> edx, 4
        <span style="color: #b6a0ff;">mov</span> rdi, rbx
        <span style="color: #b6a0ff;">call</span> qword ptr <span style="color: #ffffff;">[</span>rip + __rust_dealloc@GOTPCREL<span style="color: #ffffff;">]</span>
        <span style="color: #b6a0ff;">mov</span> rdi, r14
        <span style="color: #b6a0ff;">call</span> _Unwind_Resume@PLT

======================= Additional context =========================

<span style="color: #b6a0ff;">.section</span> .rodata..L__unnamed_2,<span style="color: #79a8ff;">"a"</span>,@progbits
        <span style="color: #b6a0ff;">.ascii</span>  <span style="color: #79a8ff;">"took "</span>
        <span style="color: #b6a0ff;">.size</span>   .L__unnamed_2, 5

<span style="color: #b6a0ff;">.section</span> .rodata..L__unnamed_3,<span style="color: #79a8ff;">"a"</span>,@progbits
        <span style="color: #b6a0ff;">.byte</span>   10
        <span style="color: #b6a0ff;">.size</span>   .L__unnamed_3, 1

<span style="color: #b6a0ff;">.section</span> .data.rel.ro..L__unnamed_1,<span style="color: #79a8ff;">"aw"</span>,@progbits
        <span style="color: #b6a0ff;">.p2align</span>        3, 0x0
        <span style="color: #b6a0ff;">.quad</span>   .L__unnamed_2
        <span style="color: #b6a0ff;">.asciz</span>  <span style="color: #79a8ff;">"\005\000\000\000\000\000\000"</span>
        <span style="color: #b6a0ff;">.quad</span>   .L__unnamed_3
        <span style="color: #b6a0ff;">.asciz</span>  <span style="color: #79a8ff;">"\001\000\000\000\000\000\000"</span>
        <span style="color: #b6a0ff;">.size</span>   .L__unnamed_1, 32
</code></pre>
</div>

</section>
<section id="slide-orgeddee2c">
<h3 id="orgeddee2c">I/O Overhead Measurement</h3>
<div class="org-src-container">

<pre  class="src src-rust"   ><code trim><span style="color: #b6a0ff;">let</span> <span style="color: #00d3d0;">start</span> = <span style="color: #00bcff;">std</span>::<span style="color: #00bcff;">time</span>::<span style="color: #6ae4b9;">Instant</span>::now<span style="color: #ffffff;">()</span>;
<span style="color: #b6a0ff;">for</span> <span style="color: #00d3d0;">i</span> <span style="color: #b6a0ff;">in</span> 0..1_000_000 <span style="color: #ffffff;">{</span>
    <span style="color: #f78fe7;">println!</span><span style="color: #ff62d4;">(</span><span style="color: #79a8ff;">"iteration </span><span style="color: #79a8ff; font-style: italic;">{}</span><span style="color: #79a8ff;">"</span>, i<span style="color: #ff62d4;">)</span>;
    my_function<span style="color: #ff62d4;">()</span>;
<span style="color: #ffffff;">}</span>
<span style="color: #f78fe7;">println!</span><span style="color: #ffffff;">(</span><span style="color: #79a8ff;">"took </span><span style="color: #79a8ff; font-style: italic;">{:?}</span><span style="color: #79a8ff;">"</span>, start.elapsed<span style="color: #ff62d4;">()</span><span style="color: #ffffff;">)</span>;
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orgf1a35ce">
<h2 id="orgf1a35ce">Summary</h2>
<ul>
<li>Rust's built-in testing capabilities</li>
<li>Testing facilities and techniques</li>
<li>Last chapter on higher-level aspects</li>
<li>Starting with chapter 7, dive deeper into Rust code</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgf22a80b">
<h2 id="orgf22a80b">Thanks!</h2>

<div id="orgb4df81c" class="figure">
<p><img src="./tim.png" alt="tim.png" />
</p>
</div>
<ul>
<li><a href="https://mastodon.social/@oylenshpeegul">@oylenshpeegul@mastodon.social</a></li>
<li>oylenshpeegul@proton.me</li>

</ul>
</section>
</section>
</div>
</div>
<script src="../dist/reveal.js"></script>
<script src="../plugin/markdown/markdown.js"></script>
<script src="../plugin/zoom/zoom.js"></script>
<script src="../plugin/notes/notes.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealMarkdown, RevealZoom, RevealNotes]
});

</script>
</body>
</html>
